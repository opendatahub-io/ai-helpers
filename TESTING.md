# Generated by Claude Code

# Testing Guide: JIRA Upload Slack Thread

This guide explains how to install and test the skill.

## Prerequisites

1. **Python 3.13+** and **uv** installed
2. **Slack MCP Server** configured with tokens
3. **JIRA MCP Server** configured
4. **Environment variables** set:
   ```bash
   export JIRA_PROJECT_URL="https://jounce.atlassian.net/"
   export JIRA_API_TOKEN="your-api-token-here"
   ```

## Installation in Claude Code

### Method 1: Auto-Discovery (Recommended)

The skill is already in the correct location: `claude-plugins/jira/skills/upload-slack-thread/`

1. **Restart Claude Code** to pick up the new skill
2. **Verify skill is available**:
   ```
   /skills
   ```
   Look for `jira:upload-slack-thread` in the list

3. **Use the skill**:
   ```
   /jira:upload-slack-thread <slack-thread-url> [ticket-key]
   ```

### Method 2: Direct Script Execution

Test the script directly without Claude Code:

```bash
# Export environment variables
export JIRA_PROJECT_URL="https://jounce.atlassian.net/"
export JIRA_API_TOKEN="your-api-token-here"

# Run the script
uv run claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869" \
  JN-1234 \
  --verbose
```

## Testing Levels

### 1. Quick Validation Tests (No MCP Required)

Test core parsing functionality:

```bash
python3 test_quick.py
```

This validates:
- ✓ URL parsing and timestamp conversion
- ✓ Ticket key extraction from text
- ✓ Input validation and error handling

### 2. Unit Tests (Mocked MCP)

Run unit tests with mocked MCP interactions:

```bash
pytest tests/unit/ -v
```

**Note:** Most unit tests are currently marked as `pytest.skip()` pending full implementation.

### 3. Contract Tests

Test CLI interface compliance:

```bash
pytest tests/contract/test_upload_slack_thread_contract.py -v
```

These verify:
- ✓ Argument parsing
- ✓ Exit codes
- ✓ Help output
- ✓ Error message formatting

### 4. Integration Tests (Requires Live MCP Servers)

Integration tests require configured Slack and JIRA MCP servers:

```bash
# Skip by default - requires live servers
pytest tests/integration/ -v --run-integration
```

**Note:** Integration tests are skipped by default. To enable:
1. Ensure MCP servers are running
2. Set environment variables
3. Update test decorators to enable

## Manual Testing Scenarios

### Scenario 1: Basic Upload

```bash
./claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869" \
  JN-1234
```

**Expected:**
- Parses URL successfully
- Fetches thread via Slack MCP
- Formats as markdown
- Posts to JIRA ticket JN-1234

### Scenario 2: Auto-Detect Ticket

```bash
./claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869"
```

**Expected:**
- Searches thread for JIRA ticket reference
- If found: uses that ticket
- If not found: prompts user to enter ticket key

### Scenario 3: Verbose Mode

```bash
./claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869" \
  JN-1234 \
  --verbose
```

**Expected:**
- Debug output to stderr showing:
  - URL parsing details
  - MCP connection status
  - Message fetching progress
  - Comment posting confirmation

### Scenario 4: Error Handling

Test invalid inputs:

```bash
# Invalid URL format
./claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://example.com/not-slack" \
  JN-1234

# Invalid ticket format
./claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869" \
  jn-1234

# Missing environment variable
unset JIRA_PROJECT_URL
./claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869" \
  JN-1234
```

## Testing in Claude Code

Once the skill is installed, you can invoke it in Claude Code:

### Example 1: Direct Invocation

```
/jira:upload-slack-thread https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869 JN-1234
```

### Example 2: Conversational

```
Upload this Slack thread to JIRA ticket JN-1234:
https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869
```

Claude will use the skill automatically if it recognizes the intent.

## Debugging Tips

### Check MCP Server Status

```bash
# List running MCP servers
ps aux | grep mcp

# Check Claude Code logs
tail -f ~/.claude/logs/claude-code.log
```

### Enable Verbose Logging

Always use `--verbose` flag during development:

```bash
export JIRA_PROJECT_URL="https://jounce.atlassian.net/"
export JIRA_API_TOKEN="your-token"

uv run claude-plugins/jira/skills/upload-slack-thread/scripts/upload_slack_thread.py \
  "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869" \
  JN-1234 \
  --verbose 2>&1 | tee debug.log
```

### Test Individual Components

Use the Python REPL to test individual functions:

```python
import sys
sys.path.insert(0, 'claude-plugins/jira/skills/upload-slack-thread/scripts')

from url_parser import parse_slack_url
from ticket_extractor import extract_ticket_from_text

# Test URL parsing
url = "https://redhat-internal.slack.com/archives/C09Q8MD1V0Q/p1769333522823869"
parsed = parse_slack_url(url)
print(f"Channel: {parsed.channel_id}, TS: {parsed.thread_ts}")

# Test ticket extraction
text = "Working on JN-1234"
ticket = extract_ticket_from_text(text)
print(f"Found: {ticket.raw_key}")
```

## Known Limitations

1. **MCP Integration Incomplete**: Functions that interact with MCP servers (`fetch_thread_messages`, `resolve_user_names`, `post_comment_to_jira`) currently raise `NotImplementedError`. These require MCP tool access at runtime.

2. **Integration Tests Skipped**: Live MCP server tests are disabled by default to avoid requiring active server connections during development.

3. **AI Summary Not Implemented**: The `--summary` flag is accepted but summary generation is not yet implemented (User Story 2).

## Next Steps

1. **Complete MCP Integration**: Implement actual MCP tool calls once runtime environment is available
2. **Run Contract Tests**: Verify CLI interface compliance
3. **Test with Live Servers**: Enable integration tests with configured MCP servers
4. **Add AI Summary**: Implement User Story 2 (optional summary generation)
5. **Add Advanced Features**: Implement remaining user stories (URL formats, auto-detection)

## Support

- **Documentation**: See `SKILL.md` and `quickstart.md` in `specs/001-jira-upload-slack-thread/`
- **Tests**: Run `pytest tests/ -v` to see test coverage
- **Issues**: Check implementation notes in source files for TODOs
